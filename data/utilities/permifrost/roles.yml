version: "1.0"

# ==========================================
# Databases
# ==========================================
databases:
  # Production
    - prep:
        shared: no
    - prod:
        shared: no
    - raw:
        shared: no
    - snowflake:
        shared: yes

  # User / Testing
    - pnadolny_raw:
        shared: no
    - pnadolny_prep:
        shared: no
    - pnadolny_prod:
        shared: no

    - userdev:
        # Common working space, schemas created by users
        shared: no

# ==========================================
# Roles
# ==========================================
roles:
    ## Admin Roles
    - accountadmin:
        warehouses:
            - admin
        member_of:
            - securityadmin
            - sysadmin

    - securityadmin:
        warehouses:
            - admin
        member_of:
            - useradmin

    - useradmin:
        warehouses:
            - admin

    - sysadmin:
        member_of:
          include:
            - "*"
          exclude:
            - accountadmin
            - securityadmin
            - useradmin
        warehouses:
            - admin
        privileges:
            databases:
                read:
                    - prep
                    - prod
                    - raw
                    - snowflake
                write:
                    - prep
                    - prod
                    - raw
            schemas:
                read:
                    - prep.*
                    - prod.*
                    - raw.*
                    - snowflake.*
                write:
                    - prep.*
                    - prod.*
                    - raw.*
            tables:
                read:
                    - prep.*.*
                    - prod.*.*
                    - raw.*.*
                    - snowflake.*.*
                write:
                    - prep.*.*
                    - prod.*.*
                    - raw.*.*

# ==========================================
# Functional Roles
# ==========================================

    - core:
        # "Core" permission level.
        # Excludes write access to `raw`
        # Excludes write access to `prep` and `prod`
        privileges:
            databases:
                read:
                    - prep
                    - prod
                    - raw
                    - snowflake
                    - userdev
                write:
                    - prep
                    - prod
                    - userdev
            schemas:
                read:
                    - prep.*
                    - prod.*
                    - raw.*
                    - snowflake.*
                    - userdev.*
                write:
                    - prep.*
                    - prod.*
                    - userdev.*
            tables:
                read:
                    - prep.*.*
                    - prod.*.*
                    - raw.*.*
                    - snowflake.*.*
                    - userdev.*.*
                write:
                    - prep.*.*
                    - prod.*.*
                    - userdev.*.*

    - loader:
        # Provides write access to `raw`
        warehouses:
            - loader
        privileges:
            databases:
                read:
                    - raw
                write:
                    - raw
            schemas:
                read:
                    - raw.*
                write:
                    - raw.*
            tables:
                read:
                    - raw.*.*
                write:
                    - raw.*.*

    - maintainer:
        # Adds maintenance-related access to `core` permissions:
        # Includes write access on `prep` and `prop`
        # Includes write access on `raw` (inherited from `loader` role)
        member_of:
            - core
            - loader
        privileges:
            databases:
                write:
                    - prep
                    - prod
            schemas:
                write:
                    - prep.*
                    - prod.*
            tables:
                write:
                    - prep.*.*
                    - prod.*.*

    - reporter:
        warehouses:
            - reporter
        privileges:
            databases:
                read:
                    - prod
            schemas:
                read:
                    - prod.*
            tables:
                read:
                    - prod.*.*

    - transformer:
        # Transformation role, excludes write access to `raw`
        warehouses:
            - transformer
        privileges:
            databases:
                read:
                    - raw
                    - prep
                    - prod
                write:
                    - prep
                    - prod
            schemas:
                read:
                    - raw.*
                    - prep.*
                    - prod.*
                write:
                    - prep.*
                    - prod.*
            tables:
                read:
                    - raw.*.*
                    - prep.*.*
                    - prod.*.*
                write:
                    - prep.*.*
                    - prod.*.*

# ==========================================
# User Roles
# ==========================================
    
    - permission_bot:
        warehouses:
            - admin

    - meltano:
        member_of:
            - loader
            - reporter
            - transformer

    - pnadolny:
        member_of:
            - core
            - loader
            - maintainer
        warehouses:
            - core
        owns:
            databases:
                - pnadolny_prep
                - pnadolny_prod
                - pnadolny_raw
            schemas:
                - pnadolny_prep.*
                - pnadolny_prod.*
                - pnadolny_raw.*
            tables:
                - pnadolny_prep.*.*
                - pnadolny_prod.*.*
                - pnadolny_raw.*.*
        privileges:
            databases:
                read:
                    - pnadolny_prep
                    - pnadolny_prod
                    - pnadolny_raw
                write:
                    - pnadolny_prep
                    - pnadolny_prod
                    - pnadolny_raw
            schemas:
                read:
                    - pnadolny_prep.*
                    - pnadolny_prod.*
                    - pnadolny_raw.*
                write:
                    - pnadolny_prep.*
                    - pnadolny_prod.*
                    - pnadolny_raw.*
            tables:
                read:
                    - pnadolny_prep.*.*
                    - pnadolny_prod.*.*
                    - pnadolny_raw.*.*
                write:
                    - pnadolny_prep.*.*
                    - pnadolny_prod.*.*
                    - pnadolny_raw.*.*

    - tmurphy:
        member_of:
            - core
            - developer
            - maintainer
        warehouses:
            - core

    - developer:
        # Every Meltano team member has developer permissions.
        # This gives full permissions to analyze and develop, with
        # zero permissions to break anything in production processes
        # or workloads:
        # - Allows read on all non-protected / non-special data.
        # - Allows write on `userdev`.
        # - Disallows write on `raw`, `prep`, or `prod`.
        member_of:
            - core
        warehouses:
            - core

# ==========================================
# Users
# ==========================================
users:

    - meltano:
        can_login: yes
        member_of:
            - meltano

    - permission_bot:
        can_login: yes
        member_of:
            - securityadmin
            - sysadmin
            - permission_bot

    - pnadolny:
        can_login: yes
        member_of:
            - pnadolny  # TODO - migrate to generic 'developer' role?
            - accountadmin
            - securityadmin
            - useradmin
            - sysadmin
            - developer

    - tmurphy:
        can_login: yes
        member_of:
            - tmurphy  # TODO - migrate to generic 'developer' role?
            - accountadmin
            - securityadmin
            - useradmin
            - sysadmin
            - developer

    - aaronsteers:
        can_login: yes
        member_of:
            - developer

# ==========================================
# Warehouses
# ==========================================
warehouses:
    - admin:
        size: x-small

    - core:
        size: x-small

    - loader:
        size: x-small

    - reporter:
        size: x-small

    - transformer:
        size: x-small
