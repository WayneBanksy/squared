version: 1
default_environment: userdev
send_anonymous_usage_stats: true
project_id: c15e971a-d318-4a9d-979b-1039ce5fd1b1
include_paths:
- ./environments/*.meltano.yml
- ./extract/*.meltano.yml
- ./load/*.meltano.yml
- ./orchestrate/*.meltano.yml
- ./transform/*.meltano.yml
- ./utilities/*.meltano.yml
schedules:
- name: meltanohub_el
  interval: 0 6 * * *
  job: meltanohub_el

- name: spreadsheets_anywhere_el
  interval: 0 6 * * *
  job: spreadsheets_anywhere_el

- name: snowplow_el
  interval: 0 6 * * 1-5
  job: snowplow_el

- name: github_search_el
  interval: 0 6 * * *
  job: github_search_el

- name: github_meltano_el
  interval: 0 6 * * *
  job: github_meltano_el

- name: gitlab_el
  interval: 0 6 * * *
  job: gitlab_el

- name: slack_el
  interval: 0 6 * * *
  job: slack_el

- name: google_analytics_el
  interval: 0 6 * * *
  job: google_analytics_el

- name: hub_metrics_prep_and_publish
  interval: 0 9 * * *
  job: hub_metrics_prep_and_publish

- name: marts_refresh
  interval: 0 8 * * * 1-5
  job: marts_refresh

jobs:
- name: meltanohub_el
  tasks:
  - tap-meltanohub target-snowflake
  - dbt-snowflake:run_staging_meltanohub
  - dbt-snowflake:test_staging_meltanohub

- name: spreadsheets_anywhere_el
  tasks:
  - tap-spreadsheets-anywhere coalesce-gcp-ips target-snowflake
  - dbt-snowflake:run_staging_spreadsheets_anywhere
  - dbt-snowflake:test_staging_spreadsheets_anywhere

- name: snowplow_el
  tasks:
  - dbt-snowflake:run_staging_snowplow
  - dbt-snowflake:test_staging_snowplow

- name: github_search_el
  tasks:
  - tap-github-search target-snowflake
  - dbt-snowflake:run_staging_github_search
  - dbt-snowflake:test_staging_github_search

- name: github_meltano_el
  tasks:
  - tap-github-meltano target-snowflake
  - dbt-snowflake:run_staging_github_meltano
  - dbt-snowflake:test_staging_github_meltano

- name: gitlab_el
  tasks:
  - tap-gitlab target-snowflake
  - dbt-snowflake:run_staging_gitlab
  - dbt-snowflake:test_staging_gitlab

- name: slack_el
  tasks:
  - tap-slack target-snowflake
  - dbt-snowflake:run_staging_slack
  - dbt-snowflake:test_staging_slack

- name: google_analytics_el
  tasks:
  - tap-google-analytics target-snowflake
  - great_expectations:test_ga_raw
  - dbt-snowflake:run_staging_google_analytics
  - dbt-snowflake:test_staging_google_analytics

# TODO: how to reuse so I dont have to redefine twice
- name: hub_metrics_prep
  tasks:
  - dbt-snowflake:run_hub_metrics
  - dbt-snowflake:test_hub_metrics
  - great_expectations:test_dbt_hub_metrics
  - tap-snowflake-metrics target-yaml-metrics
  - tap-snowflake-audit target-yaml-audit

- name: hub_metrics_prep_and_publish
  tasks:
  - dbt-snowflake:run_hub_metrics
  - dbt-snowflake:test_hub_metrics
  - great_expectations:test_dbt_hub_metrics
  - tap-snowflake-metrics target-yaml-metrics
  - tap-snowflake-audit target-yaml-audit
  - awscli:s3_copy_metrics awscli:s3_copy_audit

- name: marts_refresh
  tasks:
  - dbt-snowflake:run_marts
  - dbt-snowflake:test_marts
